{{ 'login-register.css' | asset_url | stylesheet_tag }}
{{ 'login-register.js' | asset_url | script_tag }}

<div class="row">
  <div class="small-12 columns">
    <div class="thb-form-container">
      <div class="thb-register-form">
        {% form 'create_customer' %}
          <h5>{{ 'customer.login_page.create_account' | t }}</h5>
          <h4>{{ 'customer.login_page.create_account_dec' | t }}</h4>
          <p>{{ 'customer.login_page.create_account_description' | t }}</p>
          {% if form.errors %}
            <div class="form-notification error">
              {% render 'svg-icons' with 'thb-error' %}
              {{ form.errors | default_errors }}
            </div>
          {% endif %}
          <div class="create_form_wrapper">
            <div class="fields">
              <div class="field">
                <label for="first_name">{{ 'customer.login_page.first_name' | t }}</label>
                <input
                  type="text"
                  name="customer[first_name]"
                  class="full"
                  value="{% if form.first_name %}{{ form.first_name }}{% endif %}"
                  placeholder="{{ 'customer.login_page.first_name' | t }}"
                >
              </div>
              <div class="field">
                <label for="last_name">{{ 'customer.login_page.last_name' | t }}</label>
                <input
                  type="text"
                  name="customer[last_name]"
                  class="full"
                  value="{% if form.last_name %}{{ form.last_name }}{% endif %}"
                  placeholder="{{ 'customer.login_page.last_name' | t }}"
                >
              </div>
            </div>
            <div class="field">
              <label for="number">{{ 'customer.login_page.Mobile' | t }}</label>
              <div class="field--country_codee">
                <span>+971</span>
                <input
                      type="tel"
                      placeholder="{{ 'customer.login_page.mobile'| t }}"
                      class="full numeric"
                      name="number"
                      id="mobile"
                      inputmode="numeric"
                      required
                      maxlength="9"
                      oninput="validateInputt()"
                  >
              </div>
            </div>
            <div class="field">
              <label for="email">{{ 'customer.login_page.email' | t }}</label>
              <input
                type="email"
                name="customer[email]"
                class="full {% if form.errors contains 'email' %}invalid{% endif %}"
                value=""
                placeholder="{{ 'customer.login_page.email_place' | t }}"
                required
              >
            </div>

            <div class="field">
              <label for="confirm_email">{{ 'customer.login_page.confirm_email' | t }}</label>
              <input
                type="email"
                name="customer[confirm_email]"
                class="full {% if form.errors contains 'confirm_email' %}invalid{% endif %}"
                value=""
                placeholder="{{ 'customer.login_page.confirm_email_place' | t }}"
                required
              >
            </div>

            <div class="field">
              <label for="locationInput">{{ 'customer.login_page.address' | t }}</label>
              <input
                type="text"
                name="addressInput"
                id="locationInput"
                placeholder="{{ 'customer.login_page.address_place' | t }}"
                onkeydown="handleEnterKey(event)"
              >
              <div class="location_icon" onclick="openPopup()">
                {% render 'svg-icons' with 'location' %}
              </div>           

            <!-- Popup content -->
            <div id="popup">
              <!-- Input field for address -->
              <label for="addressInput">Address</label>
              <input type="text" id="addressInput" placeholder="Enter address" onkeydown="handleEnterKey(event)">

              <!-- Container for the map -->
              <div id="map"></div>

              <!-- Display selected location as text -->
              <div id="locationText"></div>

              <!-- Button to show map based on address -->
              <button type="button" onclick="showMapForAddress()">Show on Map</button>

              <!-- Close button -->
              <button type="button" class="close-icon" onclick="closePopup()">&#128473;</button>
            </div>
            </div>

              <div class="field-area">
                <div id="otppopup">
                  <div class="popup-wrapper">
                    <h1 class="popup-title">Validate your Mobile Number</h1>
                    <p class="popup-subtitle">We sent a code to your Mobile Phone.</p>
                    <div class="popup-otp-wrapper">
                      <label for="OneTimePassword">One Time Password</label>
                      <div class="popup-otp-input-box">
                        <input
                          type="text"
                          name="OneTimePassword"
                          id="OneTimePassword1"
                          maxlength="1"
                          oninput="validateAndSwitch(this, 'OneTimePassword2')"
                          autocomplete="off"
                        >
                        <input
                          type="text"
                          name="OneTimePassword"
                          id="OneTimePassword2"
                          maxlength="1"
                          oninput="validateAndSwitch(this, 'OneTimePassword3')"
                          autocomplete="off"
                        >
                        <input
                          type="text"
                          name="OneTimePassword"
                          id="OneTimePassword3"
                          maxlength="1"
                          oninput="validateAndSwitch(this, 'OneTimePassword4')"
                          autocomplete="off"
                        >
                        <input
                          type="text"
                          name="OneTimePassword"
                          id="OneTimePassword4"
                          maxlength="1"
                          oninput="validateAndSwitch(this, 'OneTimePassword5')"
                          autocomplete="off"
                        >
                        <input
                          type="text"
                          name="OneTimePassword"
                          id="OneTimePassword5"
                          maxlength="1"
                          oninput="validateAndSwitch(this, 'OneTimePassword6')"
                          autocomplete="off"
                        >
                        <input
                          type="text"
                          name="OneTimePassword"
                          id="OneTimePassword6"
                          maxlength="1"
                          oninput="validateAndSwitch(this, null)"
                          autocomplete="off"
                        >
                      </div>
                      <p class="timing">
                          <a id="resendLink_reg" onclick="startTimerOnClick()">Resend code </a><span id="timer"></span>
                      </p>                     
                      <button type="button" onclick="saveOtpPopup(event)" class="button full" id="verifyOtpbtn" disabled>
                      <span>Validate your Mobile Number</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
                     

            <div class="field">
              <label for="address" name="address">{{ 'customer.login_page.address2' | t }}</label>
              <textarea
                name="address"
                placeholder="{{ 'customer.login_page.address2_place' | t }}"
                class="full"
                id="address"
              ></textarea>
            </div>

            <div class="fields">
              <div class="field">
                <label for="regi_city" name="city">{{ 'customer.addresses.city' | t }}</label>
                <select
                  name="city"
                  id="regi_city"
                  placeholder="{{ 'customer.addresses.city_reg' | t }}"
                  class="full"
                  onchange="getCityDistricts(this.value)"
                >
                  <option value="">{{ 'customer.addresses.city_reg' | t }}</option>
                </select>
              </div>

              <div class="field">
                <label for="district">{{ 'customer.addresses.district' | t }}</label>
                <select
                  name="district"
                  placeholder="{{ 'customer.addresses.district_reg' | t }}"
                  id="district"
                  class="full"
                >
                  <option value="">{{ 'customer.addresses.district_reg' | t }}</option>
                </select>
              </div>
            </div>
            <div class="terms_condition-checkbox">
              <input type="checkbox" value="" required>
              <span>I accept and agree to the <a href="#">Terms and Condition</a></span>
            </div>
            <button type="button" class="button full" id="regi_button" onclick="openOTPPopup()">
              <span>{{ 'customer.login_page.submit_register' | t }}</span>
            </button>            
          </div>
        {% endform %}
        <div class="switch-login-section">
          {{ 'customer.login_page.already_have_an_account' | t }}
          {% assign text_button_title = 'customer.login_page.login' | t %}
          {% render 'text-button', url: routes.account_login_url, title: text_button_title %}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const apiUrl = 'https://alainuat.gdadmin.org/laravel/public/api/sendOTP';

        // Use the fetch function to make a POST request to the API
        // fetch(apiUrl, {
        //     method: 'POST',
        //     body: JSON.stringify({ mobile: numericValue }),
        //     headers: {
        //         'Content-Type': 'application/json'
        //     },
        // })
        .then(response => {
            if (!response.ok) {
                throw new Error(`Network response was not ok: ${response.status}`);
            }
            
            return response.json();
        })
        .then(data => {
            console.log('MSS Test', data);
      
      })
      .catch(error => {
        // Handle errors that may occur during the fetch operation
        console.error('Error fetching data:', error);
      });
  
var mobileInput = document.getElementById('mobile');
  var verifyOTP = document.getElementById('verifyOtpbtn');
  verifyOTP.addEventListener('click', function () {
  var OTP = document.getElementById('OneTimePassword1').value+document.getElementById('OneTimePassword2').value+document.getElementById('OneTimePassword3').value+document.getElementById('OneTimePassword4').value+document.getElementById('OneTimePassword5').value+document.getElementById('OneTimePassword6').value;
    const apiUrl = 'https://alainuat.gdadmin.org/laravel/public/api/veryfyOTP';
      
      // Use the fetch function to make a GET request to the API
      fetch(apiUrl, {
        method: 'POST',
        body:JSON.stringify({mobileNo: mobileInput.value,otp: OTP}),
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(`Network response was not ok: ${response.status}`);
        }
        
        return response.json();
      })
      .then(data => {
        console.log('MSS Test',data);
      
      })
      .catch(error => {
        // Handle errors that may occur during the fetch operation
        console.error('Error fetching data:', error);
      });
});
</script>